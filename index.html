<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
    <title>Swiss planner</title>
  </head>
  <body>
    <h1>Hello World</h1>
    <p>I'm hosted with GitHub Pages.</p>
    <form autocomplete="off">
      <table>
        <tr><th>From</th><th>To</th></tr>
        <tr>
          <td><input id="from" size="30"></input></td>
          <td><input id="to" size="30"></input></td>
        </tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
        <tr><td class="fromOption"></td><td class="toOption"></td></tr>
      </table>
    </form>
  </body>
  <script>
    var from = document.querySelector('#from');
    var to = document.querySelector('#to');
    var fromOptionList = document.querySelectorAll('td.fromOption');
    var toOptionList = document.querySelectorAll('td.toOption');
    var iconList = ["sl-icon-type-bus", "sl-icon-type-fun", "sl-icon-type-sb", "sl-icon-type-ship", "sl-icon-type-tram", "sl-icon-type-zug", "sl-icon-type-gondola", "sl-icon-type-chairlift", "sl-icon-type-train", "sl-icon-type-post", "sl-icon-type-night-bus", "sl-icon-type-strain", "sl-icon-type-night-strain", "sl-icon-type-express-train"];
    
    from.addEventListener('input', function() {
      httpGet('https://timetable.search.ch/api/completion.json?term=' + from.value, 'from', locationsCallback);
    });
    to.addEventListener('input', function() {
      httpGet('https://timetable.search.ch/api/completion.json?term=' + to.value, 'to', locationsCallback);
    });
    
    fromOptionList.forEach(function(fromOption) {
      fromOption.addEventListener('click', function() {
        if (fromOption.innerHTML === "") {
          return;
        }
        from.value = fromOption.innerHTML;
        for (option of fromOptionList) {
          option.style.backgroundColor = "white";
        }
        fromOption.style.backgroundColor = "#eee";
      });
    });
    toOptionList.forEach(function(toOption) {
      toOption.addEventListener('click', function() {
        if (toOption.innerHTML === "") {
          return;
        }
        to.value = toOption.innerHTML;
        for (option of toOptionList) {
          option.style.backgroundColor = "white";
        }
        toOption.style.backgroundColor = "#eee";
      });
    });
    
    function locationsCallback(json, type) {
      var stationList = []
      for (station of json) {
        if (iconList.includes(station.iconclass)) {
          stationList.push(station.label);
        }
      }
      if (type === 'from') {
        for (fromOption of fromOptionList) {
          fromOption.innerHTML = "";
          fromOption.style.backgroundColor = "white";
        }
        for (var i = 0; i < stationList.length; i++) {
          fromOptionList[i].innerHTML = stationList[i];
        }
      } else {
        for (toOption of toOptionList) {
          toOption.innerHTML = "";
          toOption.style.backgroundColor = "white";
        }
        for (var i = 0; i < stationList.length; i++) {
          toOptionList[i].innerHTML = stationList[i];
        }
      }
    }
    
    function httpGet(url, type, callback) {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState === XMLHttpRequest.DONE && xmlHttp.status === 200) {
          callback(JSON.parse(xmlHttp.responseText), type);
        }
      }
      xmlHttp.open("GET", url, true);
      xmlHttp.send(null);
    }
  </script>
</html>
